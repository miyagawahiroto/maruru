<!DOCTYPE html>

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <title>マルる</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="style_task.css">
</head>


<body>

    <div class="hdr">
        <img class="icon" src="img/m1.jpg" height="100" width="100">
        <p class="kinou">〈</p>
        <p class="day1">今日</p>
        <p class="asu">〉</p>
        <img class="menu" src="img/menu1.png" height="100" width="100">
    </div>
    <div class="pct" id="pctid">
        <a class="return" id="return" href="maruru.html">←もどる</a>
        <div class="user_count_div1" id="usercountdiv">
            <p class="user_count1">現在</p>
            <p class="user_count2" id="num"></p>
            <p class="user_count3">が会議中です</p>
        </div>


        <div id="task_icon_div">
            <svg class="task_icon" version="1.1" id="_x32_" style="fill:#c0c0c0;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 512 512" xml:space="preserve">
                <style type="text/css">
                    
                </style>
                <g>
                    <path class="st0" d="M47.44,302.813c26.214,0,47.416-21.242,47.416-47.44c0-26.198-21.202-47.44-47.416-47.44
                        c-26.206,0-47.44,21.242-47.44,47.44C0,281.571,21.234,302.813,47.44,302.813z" ></path>
                    <path class="st0" d="M47.391,318.984c-25.513,0-46.331,20.679-46.331,46.315v57.588h54.882l35.408-72.325
                        C85.278,332.108,67.948,318.984,47.391,318.984z"></path>
                    <path class="st0" d="M125.039,212.114c23.476,0,42.476-19.009,42.476-42.5c0-23.451-19-42.493-42.476-42.493
                        c-23.475,0-42.492,19.042-42.492,42.493C82.548,193.106,101.564,212.114,125.039,212.114z"></path>
                    <path class="st0" d="M83.427,310.564v9.154h23.027l42.109-85.816c-6.683-4.711-14.737-7.303-23.524-7.303
                        c-5.942,0-11.64,1.231-16.718,3.465c3.22,7.808,5.078,16.343,5.078,25.268C113.399,278.489,101.506,298.794,83.427,310.564z"></path>
                    <path class="st0" d="M250.991,129.828c23.475,0,42.484-19.009,42.484-42.5c0-23.451-19.009-42.493-42.484-42.493
                        c-23.476,0-42.492,19.042-42.492,42.493C208.499,110.819,227.516,129.828,250.991,129.828z"></path>
                    <path class="st0" d="M250.991,144.28c-22.946,0-41.579,18.609-41.579,41.587v18.022h83.15v-18.022
                        C292.562,162.889,273.962,144.28,250.991,144.28z"></path>
                    <path class="st0" d="M464.56,302.813c26.206,0,47.44-21.242,47.44-47.44c0-26.198-21.234-47.44-47.44-47.44
                        c-26.223,0-47.415,21.242-47.415,47.44C417.145,281.571,438.338,302.813,464.56,302.813z"></path>
                    <path class="st0" d="M464.609,318.984c-20.557,0-37.887,13.123-43.959,31.578l35.409,72.325h54.882v-57.588
                        C510.941,339.664,490.122,318.984,464.609,318.984z"></path>
                    <path class="st0" d="M386.962,212.114c23.467,0,42.492-19.009,42.492-42.5c0-23.451-19.025-42.493-42.492-42.493
                        c-23.476,0-42.476,19.042-42.476,42.493C344.485,193.106,363.486,212.114,386.962,212.114z"></path>
                    <path class="st0" d="M386.962,226.599c-8.788,0-16.841,2.592-23.533,7.303l42.117,85.816h23.027v-9.154
                        c-18.079-11.771-29.972-32.075-29.972-55.233c0-8.925,1.858-17.46,5.078-25.268C398.601,227.83,392.904,226.599,386.962,226.599z"></path>
                    <path class="st0" d="M176.147,219.874L66.441,443.746v23.419h379.12v-23.419L335.853,219.874H176.147z M200.812,398.792h-60.8
                        l17.713-41.302h50.178L200.812,398.792z M220.474,311.502h-47.848l13.931-32.506h39.5L220.474,311.502z M370.552,398.792h-60.783
                        l-7.1-41.302h50.178L370.552,398.792z M290.101,311.502l-5.592-32.506h39.502l13.938,32.506H290.101z"></path>
                </g>
                </svg>
        </div>
        <div class="lnkbtn" id="lnkbtn" onclick="onCLICK1()">
            <img class="btn" id="btn" src="img/start3.png">
        </div>

    </div>


    <script>
        var count = 0;
        var btncount = 0;
        var isInit = false;

        const firebaseConfig = {
            apiKey: "AIzaSyCprQLyu418PTM875OtqqJk6bqNAg5n_TY",
            authDomain: "maruru-63d5d.firebaseapp.com",
            projectId: "maruru-63d5d",
            storageBucket: "maruru-63d5d.appspot.com",
            messagingSenderId: "199289528279",
            appId: "1:199289528279:web:0d73d7d39708f617203592"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Initialize Cloud Firestore and get a reference to the service
        const db = firebase.firestore();


        //
        db.collection("users").doc("count")
            .onSnapshot((doc) => {
                count = doc.data().task3;

                document.getElementById("num").textContent =count+"人";
                document.getElementById("num").style = "animation: fadeIn 0.7s cubic-bezier(0.33, 1, 0.68, 1) 1 forwards;";
                console.log("count : " + count);
                isInit = true;

                window.setTimeout(() => {
                    document.getElementById("num").style = "animation: none";
                }, 3000);
            });

    
        function onCLICK1() {
            if (!isInit) return;

            if (btncount == 0) {
                count++;
                document.getElementById("return").remove();
                document.getElementById("usercountdiv").className = 'user_count_div2';
                document.getElementById("num").className = 'user_count2';
                document.getElementById("_x32_").style = "fill:rgb(255, 172, 25); animation: 4s linear infinite rotation;";

                document.getElementById("btn").src = "img/finish3.png";
                btncount++;
                console.log("count : " + btncount);

            } else {
                count--;
                btncount--;
                console.log("count : " + btncount);
                window.location.href = 'maruru.html';
            }


            var washingtonRef = db.collection("users").doc("count");

            // Set the "capital" field of the city 'DC'
            return washingtonRef.update({
                task3: count
            })

                .then(() => {
                    console.log("Document successfully updated!");

                })
                .catch((error) => {
                    // The document probably doesn't exist.
                    console.error("Error updating document: ", error);
                });
        }

    </script>

</body>

</html>